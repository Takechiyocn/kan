## 线程和进程

### 线程和进程区别

* 进程
  
    * 子进程代码段与父进程共享
      
    * 子进程的所有资源都继承自父进程，得到父进程资源的副本
    
    * 子进程可获得父进程的所有堆和栈的数据，但而这并不共享地址空间
    
    * 两个是单独的进程，继承资源后二者没有关联，子进程单独运行
    
    * 进程开销大，利于资源保护
    
* 线程

    * 线程开销小，不利于资源保护
    
    * 线程共享同一进程的地址空间，所以通信速度快，切换更快

### 关键字

volatile

* 概述

    JVM提供的一种免锁的同步访问机制，volatile变量直接从主内存读写最新值

* 特点

    * 变量可见性
      
      保证变量对所有线程可见，即线程修改后新值对其他线程可见
  
    * 不保证原子性
        
        不能确保翻转域(下述done = !done)中的值，即不能保证读取、翻转和写入不被中断
  
    * 禁止指令重排
    
        * 内存屏障指令禁止重排序
    
            一个CPU指令，可以保证特定的操作顺序，可以保证某些变量的内存可见性
  
* volatile变量传递性

  如果A happens-before B, B happens-before C，那 A happens-before C

### 指令重排

    程序并不是按照编写顺序执行，编译器会优化重排，指令并行也可能会重排，内存系统也会重排。
    处理器在进行指令重排的时候，会考虑数据之间的依赖性
